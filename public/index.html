<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Big 12 Women's Tennis Standings</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Configure axios
        axios.interceptors.request.use(request => {
            console.log('Starting Request:', request);
            return request;
        });

        axios.interceptors.response.use(
            response => {
                console.log('Response:', response);
                return response;
            },
            error => {
                console.log('Response Error:', error);
                return Promise.reject(error);
            }
        );
    </script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Big 12 Women's Tennis Standings</h1>
            <p class="text-gray-600">Final Seedings with Tiebreaker Analysis</p>
        </header>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <h2 class="text-xl font-semibold p-4 bg-gray-50 border-b">Final Seedings</h2>
            <div id="standings" class="divide-y divide-gray-200">
                <!-- Loading state -->
                <div class="p-4 space-y-3 animate-pulse">
                    <div class="h-5 bg-gray-200 rounded w-3/4"></div>
                    <div class="h-5 bg-gray-200 rounded w-1/2"></div>
                    <div class="h-5 bg-gray-200 rounded w-5/6"></div>
                    <div class="h-5 bg-gray-200 rounded w-3/4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchStandings() {
            try {
                console.log('Fetching final standings/seedings...');
                const response = await axios.get('/api/tennis/standings'); 
                console.log('Standings response:', response.data);
                const standings = response.data.standings || [];
                console.log('Processed standings (final seeding):', standings);
                
                let standingsHtml = '';
                let currentTieGroup = [];
                let lastRecord = null;

                // Function to render a group of tied teams
                function renderGroup(group, addBrackets) {
                    let groupHtml = '';
                    const bracketClass = addBrackets ? 'border-l-4 border-blue-500 pl-3 ml-1' : '';
                    group.forEach((team, index) => {
                        const tiebreakerText = (team.tiebreaker && team.tiebreaker !== 'None needed') 
                            ? `<div class="text-xs text-gray-500 mt-1">${team.tiebreaker}</div>` 
                            : '';
                        groupHtml += `
                            <div class="flex justify-between items-start p-3 ${bracketClass}">
                                <div>
                                    <span class="font-semibold text-lg block">${team.seed}. ${team.team}</span>
                                    ${tiebreakerText}
                                </div>
                                <div class="text-right flex-shrink-0 ml-4">
                                    <span class="text-gray-700 font-medium text-sm">${team.confRecord || 'N/A'}</span>
                                </div>
                            </div>
                        `;
                    });
                    return groupHtml;
                }

                // Group teams by record to identify ties
                standings.forEach((team, index) => {
                    if (lastRecord !== null && team.confRecord === lastRecord) {
                        // Continue existing tie group
                        currentTieGroup.push(team);
                    } else {
                        // Finish previous group (if any)
                        if (currentTieGroup.length > 0) {
                            standingsHtml += renderGroup(currentTieGroup, currentTieGroup.length > 1);
                        }
                        // Start new group
                        currentTieGroup = [team];
                        lastRecord = team.confRecord;
                    }
                });
                // Render the last group
                if (currentTieGroup.length > 0) {
                     standingsHtml += renderGroup(currentTieGroup, currentTieGroup.length > 1);
                }

                console.log('Generated standings HTML:', standingsHtml);
                document.getElementById('standings').innerHTML = standingsHtml || '<p class="text-gray-500 p-4">No standings available</p>';
            } catch (error) {
                console.error('Error fetching standings:', error);
                console.error('Error details:', error.response?.data || error.message);
                document.getElementById('standings').innerHTML = '<p class="text-red-500 p-4">Error loading standings</p>';
            }
        }

        // Function to refresh data periodically
        function startAutoRefresh() {
            console.log('Starting auto-refresh...');
            fetchStandings();
            setInterval(() => {
                console.log('Auto-refreshing data...');
                fetchStandings();
            }, 30000); // Refresh every 30 seconds
        }

        console.log('Page loaded, initializing...');
        startAutoRefresh();
    </script>
</body>
</html> 